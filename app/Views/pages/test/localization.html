<!-- app/Views/pages/test/localization.html -->
{% extends "layouts/base.html" %}

{% block title %}{{ 'common.welcome' | t }} - Localization Demo{% endblock %}

{% block styles %}
<style>
    /* ===== Localization Demo Specific Styles ===== */

    /* Alert Styles */
    .alert {
        padding: 15px;
        margin: 20px 0;
        border: 1px solid transparent;
        border-radius: 8px;
        position: relative;
    }

    .alert-success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        border-color: #c3e6cb;
        box-shadow: 0 2px 4px rgba(21, 87, 36, 0.1);
    }

    .alert-info {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        color: #0c5460;
        border-color: #bee5eb;
    }

    .alert-warning {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
        border-color: #ffeaa7;
    }

    /* Language Switcher */
    .language-switcher {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        padding: 25px;
        border-radius: 12px;
        margin: 25px 0;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 1px solid #90caf9;
    }

    .language-switcher h3 {
        margin-bottom: 20px;
        color: #1565c0;
        font-size: 1.4em;
    }

    .language-switcher form {
        display: inline-block;
    }

    .language-switcher select {
        padding: 12px 20px;
        font-size: 16px;
        border: 2px solid #2196f3;
        border-radius: 8px;
        background: white;
        color: #333;
        cursor: pointer;
        min-width: 200px;
        transition: all 0.3s ease;
    }

    .language-switcher select:hover {
        border-color: #1976d2;
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
    }

    .language-switcher select:focus {
        outline: none;
        border-color: #0d47a1;
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
    }

    /* Demo Sections */
    .demo-section {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 5px solid #007bff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    .demo-section h4 {
        color: #495057;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e9ecef;
        font-size: 1.2em;
    }

    .demo-section ul {
        list-style: none;
        padding-left: 0;
    }

    .demo-section li {
        margin: 12px 0;
        padding: 10px;
        background: white;
        border-radius: 6px;
        border-left: 3px solid #28a745;
        transition: all 0.2s ease;
    }

    .demo-section li:hover {
        background: #f0f8f0;
        transform: translateX(5px);
    }

    /* Translation Examples */
    .translation-examples {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .example-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #e9ecef;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .example-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .example-card h5 {
        color: #6f42c1;
        margin-bottom: 15px;
        font-size: 1.1em;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 8px;
    }

    /* Syntax Highlighting */
    .syntax-example {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        margin: 10px 0;
        overflow-x: auto;
        border-left: 4px solid #4299e1;
    }

    .syntax-highlight {
        color: #f687b3;
        font-weight: bold;
    }

    .filter-syntax {
        color: #68d391;
    }

    .parameter-syntax {
        color: #fbb6ce;
    }

    /* Filter Examples Grid */
    .filter-examples {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
    }

    @media (max-width: 768px) {
        .filter-examples {
            grid-template-columns: 1fr;
        }
    }

    .filter-example {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .filter-example .syntax {
        font-family: monospace;
        color: #e83e8c;
        font-weight: bold;
        background: #f8f9fa;
        padding: 4px 8px;
        border-radius: 4px;
    }

    .filter-example .result {
        color: #28a745;
        font-weight: bold;
        margin-top: 8px;
    }

    /* Stats Section */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }

    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .stat-number {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .stat-label {
        font-size: 0.9em;
        opacity: 0.9;
    }

    /* Debug Section */
    .debug-section {
        background: #f1f3f4;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border: 1px solid #dadce0;
    }

    .debug-section details {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border: 1px solid #e0e0e0;
    }

    .debug-section summary {
        cursor: pointer;
        font-weight: bold;
        color: #1a73e8;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
        margin: -15px -15px 15px -15px;
    }

    .debug-section summary:hover {
        background: #e8f0fe;
    }

    .debug-section pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 0.9em;
        line-height: 1.4;
    }

    /* CSRF Debug */
    .csrf-debug {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
    }

    .csrf-debug code {
        background: #f8f9fa;
        padding: 4px 8px;
        border-radius: 4px;
        font-family: monospace;
        border: 1px solid #e9ecef;
    }

    .csrf-field-display {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 6px;
        font-family: monospace;
        border: 1px solid #ddd;
        margin: 10px 0;
        word-break: break-all;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
        .translation-examples {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .demo-section {
            padding: 15px;
        }

        .language-switcher {
            padding: 20px 15px;
        }

        .language-switcher select {
            min-width: 150px;
            font-size: 14px;
        }

        .stat-card {
            padding: 15px;
        }

        .stat-number {
            font-size: 1.5em;
        }
    }

    /* Animation for locale changes */
    .locale-transition {
        transition: all 0.3s ease-in-out;
    }

    .locale-changing {
        opacity: 0.7;
        transform: scale(0.98);
    }

    /* Loading indicator */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Success/Error Messages */
    .flash-message {
        padding: 12px 20px;
        margin: 15px 0;
        border-radius: 6px;
        font-weight: 500;
    }

    .flash-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .flash-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    .flash-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
    }
</style>
{% endblock %}

{% block content %}
<div class="locale-transition" id="localization-demo">
    <h2>üåç {{ 'common.welcome' | t }} - Localization Demo</h2>

    <!-- Current Language Info -->
    <div class="alert alert-success">
        <h4>{{ 'common.navigation.home' | t }} - Current Language: {{ current_locale }}</h4>
        <p><strong>Detected Locale:</strong> {{ current_locale }}</p>
        <p><strong>Available Languages:</strong> Deutsch, English, Fran√ßais, Espa√±ol</p>
    </div>

    <!-- Language Switcher - FIXED -->
    <div class="language-switcher">
        <h3>üîÑ Change Language</h3>
        <form method="POST" action="/test/localization" id="language-form">
            {{ csrf_token_field | raw }}
            <input type="hidden" name="change_language" value="1">

            <select name="locale" onchange="submitLanguageChange(this.value)">
                <option value="de" {{ current_locale == 'de' ? 'selected' : '' }}>üá©üá™ Deutsch</option>
                <option value="en" {{ current_locale == 'en' ? 'selected' : '' }}>üá∫üá∏ English</option>
                <option value="fr" {{ current_locale == 'fr' ? 'selected' : '' }}>üá´üá∑ Fran√ßais</option>
                <option value="es" {{ current_locale == 'es' ? 'selected' : '' }}>üá™üá∏ Espa√±ol</option>
            </select>
        </form>
    </div>

    <!-- Translation Filters Demo -->
    <section>
        <h3>üé® Translation Filters</h3>

        <div class="translation-examples">
            <!-- Basic Translation -->
            <div class="example-card">
                <h5>Basic Translation</h5>
                <ul>
                    <li><strong>Welcome:</strong> {{ 'common.welcome' | t }}</li>
                    <li><strong>Login:</strong> {{ 'auth.login' | t }}</li>
                    <li><strong>Password:</strong> {{ 'auth.password' | t }}</li>
                    <li><strong>Home:</strong> {{ 'common.navigation.home' | t }}</li>
                    <li><strong>Team:</strong> {{ 'common.navigation.team' | t }}</li>
                </ul>
            </div>

            <!-- Plural Translations -->
            <div class="example-card">
                <h5>Plural Translations</h5>
                <ul>
                    <li><strong>1 Goal:</strong> {{ 'game.goals' | t_plural:1 }}</li>
                    <li><strong>3 Goals:</strong> {{ 'game.goals' | t_plural:3 }}</li>
                    <li><strong>1 Player:</strong> {{ 'game.players' | t_plural:1 }}</li>
                    <li><strong>11 Players:</strong> {{ 'game.players' | t_plural:11 }}</li>
                </ul>
            </div>

            <!-- With Parameters -->
            <div class="example-card">
                <h5>With Parameters</h5>
                <ul>
                    <li><strong>Messi Goal:</strong> {{ 'match.goal_scored' | t:{player: 'Messi', minute: 90} }}</li>
                    <li><strong>Ronaldo Goal:</strong> {{ 'match.goal_scored' | t:{player: 'Cristiano', minute: 78} }}</li>
                </ul>
            </div>

            <!-- System Info -->
            <div class="example-card">
                <h5>System Info</h5>
                <ul>
                    <li><strong>Current Locale:</strong> {{ current_locale }}</li>
                    <li><strong>Match Started:</strong> {{ 'match.match_started' | t }}</li>
                    <li><strong>Live Ticker:</strong> {{ 'match.live_ticker' | t }}</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Syntax Examples -->
    <section>
        <h3>üìù Filter Syntax Examples</h3>
        <div class="demo-section">
            <div class="filter-examples">
                <div class="filter-example">
                    <h6>Basic Syntax:</h6>
                    <div class="syntax">{{ '{{ "common.welcome" | t }}' }}</div>
                    <div class="result">‚Üí {{ 'common.welcome' | t }}</div>
                </div>

                <div class="filter-example">
                    <h6>Plural Syntax:</h6>
                    <div class="syntax">{{ '{{ "game.goals" | t_plural:3 }}' }}</div>
                    <div class="result">‚Üí {{ 'game.goals' | t_plural:3 }}</div>
                </div>

                <div class="filter-example">
                    <h6>With Parameters:</h6>
                    <div class="syntax">{{ '{{ "match.goal_scored" | t:{player: "Messi"} }}' }}</div>
                    <div class="result">‚Üí {{ 'match.goal_scored' | t:{player: 'Messi', minute: 90} }}</div>
                </div>

                <div class="filter-example">
                    <h6>Filter Combinations:</h6>
                    <div class="syntax">{{ '{{ "auth.login" | t | upper }}' }}</div>
                    <div class="result">‚Üí {{ 'auth.login' | t | upper }}</div>
                </div>
            </div>

            <div class="syntax-example">
                <span class="syntax-highlight">Basic Translation:</span>
                {{ <span class="filter-syntax">'translation.key'</span> | <span class="parameter-syntax">t</span> }}

                <span class="syntax-highlight">With Parameters:</span>
                {{ <span class="filter-syntax">'message.key'</span> | <span class="parameter-syntax">t:{param: 'value', count: 5}</span> }}

                <span class="syntax-highlight">Plural Forms:</span>
                {{ <span class="filter-syntax">'items.count'</span> | <span class="parameter-syntax">t_plural:count</span> }}

                <span class="syntax-highlight">Filter Chains:</span>
                {{ <span class="filter-syntax">'text.key'</span> | <span class="parameter-syntax">t</span> | <span class="parameter-syntax">upper</span> | <span class="parameter-syntax">truncate:50</span> }}
            </div>
        </div>
    </section>

    <!-- Statistics -->
    <section>
        <h3>üìä Translation Statistics</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ current_locale | upper }}</div>
                <div class="stat-label">Current Locale</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ translator_stats.loaded_namespaces }}</div>
                <div class="stat-label">Loaded Namespaces</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">4</div>
                <div class="stat-label">Supported Languages</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ translator_stats.supported_locales | length }}</div>
                <div class="stat-label">Available Locales</div>
            </div>
        </div>
    </section>

    <!-- Demo Data Display -->
    {% if demo_data %}
    <section>
        <h3>üóÇÔ∏è Translation Data</h3>
        <div class="demo-section">
            {% if demo_data.navigation %}
            <details>
                <summary>Navigation Translations</summary>
                {% for nav in demo_data.navigation %}
                <div class="filter-example">
                    <strong>{{ nav.key }}:</strong> {{ nav.translated }}
                </div>
                {% endfor %}
            </details>
            {% endif %}

            {% if demo_data.language_names %}
            <details>
                <summary>Language Names</summary>
                {% for code, name in demo_data.language_names %}
                <div class="filter-example">
                    <strong>{{ code }}:</strong> {{ name }}
                </div>
                {% endfor %}
            </details>
            {% endif %}
        </div>
    </section>
    {% endif %}

    <!-- Debug Information -->
    <section>
        <h3>üîç Debug Information</h3>
        <div class="debug-section">
            <details>
                <summary>Language Detection Info</summary>
                <pre>{{ detection_info | json }}</pre>
            </details>

            <details>
                <summary>Translator Statistics</summary>
                <pre>{{ translator_stats | json }}</pre>
            </details>

            {% if demo_data %}
            <details>
                <summary>Demo Data Structure</summary>
                <pre>{{ demo_data | json }}</pre>
            </details>
            {% endif %}
        </div>
    </section>

    <!-- CSRF Debug (Development Only) -->
    <section>
        <h3>üîí CSRF Debug (Development)</h3>
        <div class="csrf-debug">
            <p><strong>CSRF Token Field:</strong></p>
            <div class="csrf-field-display">
                {{ csrf_token_field | default:'CSRF token not available' }}
            </div>

            <p><strong>Raw CSRF Field (for forms):</strong></p>
            <div class="csrf-field-display">
                {{ csrf_token_field | raw | default:'CSRF token not available' }}
            </div>
        </div>
    </section>
</div>

<script>
    function submitLanguageChange(locale) {
        const form = document.getElementById('language-form');
        const demo = document.getElementById('localization-demo');

        // Add loading visual feedback
        demo.classList.add('locale-changing');

        // Add loading indicator
        const select = form.querySelector('select');
        const originalHTML = select.innerHTML;
        select.innerHTML = '<option>Changing... <div class="loading"></div></option>';
        select.disabled = true;

        // Submit the form
        setTimeout(() => {
            form.submit();
        }, 200);
    }

    // Show success/error messages
    document.addEventListener('DOMContentLoaded', function() {
        // You can add flash message handling here
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('success');
        const error = urlParams.get('error');

        if (success) {
            showFlashMessage('Language changed successfully!', 'success');
        }

        if (error) {
            showFlashMessage('Failed to change language. Please try again.', 'error');
        }
    });

    function showFlashMessage(message, type) {
        const flashDiv = document.createElement('div');
        flashDiv.className = `flash-message flash-${type}`;
        flashDiv.textContent = message;

        const container = document.querySelector('.locale-transition');
        container.insertBefore(flashDiv, container.firstChild);

        // Auto-remove after 5 seconds
        setTimeout(() => {
            flashDiv.remove();
        }, 5000);
    }
</script>
{% endblock %}