<!-- app/Views/pages/security-demo.html -->
{% extends 'layouts/base' %}

{% block title %}ğŸ”’ XSS Protection Demo - {{ app_name }}{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <h1>ğŸ”’ XSS Protection Demo</h1>
    <p style="font-size: 1.1em; color: #666; margin-bottom: 30px;">
        This demo shows how our template engine automatically protects against XSS attacks while still allowing trusted
        content when needed.
    </p>

    <!-- XSS Protection Status -->
    <div style="background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%); padding: 25px; border-radius: 12px; margin: 20px 0; border: 2px solid #28a745;">
        <h2>âœ… XSS Protection Status: ACTIVE</h2>
        <p><strong>Auto-Escape:</strong> Enabled by default</p>
        <p><strong>Safe by Default:</strong> All <code>{{ "{{ variable }}" }}</code> outputs are automatically
            HTML-escaped</p>
        <p><strong>Override:</strong> Use <code>{{ "{{ variable|raw }}" }}</code> only for trusted content</p>
    </div>

    <!-- Live XSS Demo -->
    <div style="background: #fff3cd; padding: 25px; border-radius: 12px; margin: 20px 0; border-left: 6px solid #ffc107;">
        <h2>âš ï¸ Live XSS Attack Demo</h2>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            <!-- Safe Output -->
            <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; border: 2px solid #28a745;">
                <h3>âœ… SAFE: Auto-Escaped Output</h3>
                <p><strong>Template:</strong> <code>{{ "{{ malicious_input }}" }}</code></p>
                <p><strong>Result:</strong></p>
                <div style="background: white; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                    {{ malicious_input }}
                </div>
                <p><em style="color: #28a745;">â†’ XSS code is safely escaped and displayed as text</em></p>
            </div>

            <!-- Dangerous Output (for demo purposes) -->
            <div style="background: #f8d7da; padding: 20px; border-radius: 8px; border: 2px solid #dc3545;">
                <h3>âŒ DANGEROUS: Raw Output</h3>
                <p><strong>Template:</strong> <code>{{ "{{ malicious_input|raw }}" }}</code></p>
                <p><strong>Result:</strong></p>
                <div style="background: white; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                    <!-- Commented out for safety in demo -->
                    <em style="color: #dc3545;">[XSS code would execute here - disabled for safety]</em>
                    <br><code>{{ malicious_input|escape }}</code>
                </div>
                <p><em style="color: #dc3545;">â†’ âš ï¸ Only use |raw for trusted content!</em></p>
            </div>
        </div>
    </div>

    <!-- Different Input Types -->
    <div style="background: #e7f3ff; padding: 25px; border-radius: 12px; margin: 20px 0; border-left: 6px solid #007bff;">
        <h2>ğŸ¯ Various XSS Attack Vectors (All Blocked)</h2>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            {% for example in examples %}
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4>{{ example.context }}</h4>
                <p><strong>Input:</strong></p>
                <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; overflow-x: auto;">{{ example.input|escape }}</pre>
                <p><strong>Safe Output:</strong></p>
                <pre style="background: #e8f5e8; padding: 10px; border-radius: 4px; font-size: 12px; overflow-x: auto;">{{ example.safe_output|escape }}</pre>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Context-Specific Escaping -->
    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 20px 0; border-left: 6px solid #6c757d;">
        <h2>ğŸ›¡ï¸ Context-Specific Escaping Strategies</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
            <!-- HTML Context -->
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4>HTML Content</h4>
                <p><strong>Template:</strong> <code>{{ "{{ user_input|escape:'html' }}" }}</code></p>
                <p><strong>Output:</strong></p>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; word-break: break-all;">
                    {{ user_input|escape:'html' }}
                </div>
            </div>

            <!-- Attribute Context -->
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4>HTML Attributes</h4>
                <p><strong>Template:</strong> <code>{{ 'value="{{ user_input|escape:\'attr\' }}"' }}</code></p>
                <p><strong>Output:</strong></p>
                <input readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" type="text"
                       value="{{ user_input|escape:'attr' }}">
            </div>

            <!-- URL Context -->
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4>URL Parameters</h4>
                <p><strong>Template:</strong> <code>{{ 'href="?q={{ search_term|escape:\'url\' }}"' }}</code></p>
                <p><strong>Output:</strong></p>
                <a href="?search={{ search_term|escape:'url' }}" style="color: #007bff; text-decoration: none;">
                    Search Link (Check URL)
                </a>
            </div>

            <!-- CSS Context -->
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4>CSS Values</h4>
                <p><strong>Template:</strong> <code>{{ 'class="{{ css_class|escape:\'css\' }}"' }}</code></p>
                <p><strong>Output:</strong></p>
                <div class="{{ css_class|escape:'css' }}"
                     style="background: #e8f5e8; padding: 8px; border-radius: 4px;">
                    CSS class applied safely
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Integration (Safe) -->
    <div style="background: #fff8e1; padding: 25px; border-radius: 12px; margin: 20px 0; border-left: 6px solid #ff9800;">
        <h2>ğŸŸ¨ JavaScript Integration (Safe Methods)</h2>

        <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd; margin-top: 15px;">
            <h4>âœ… Method 1: Data Attributes (Recommended)</h4>
            <div data-malicious="{{ malicious_input|escape:'attr' }}"
                 data-search-term="{{ search_term|escape:'attr' }}"
                 data-user-input="{{ user_input|escape:'attr' }}"
                 id="js-data"
                 style="background: #f0f0f0; padding: 15px; border-radius: 4px; margin: 10px 0;">
                <em>Data stored in HTML data-* attributes (check browser console)</em>
            </div>

            <h4>âœ… Method 2: JSON Data Islands</h4>
            <script id="page-data" type="application/json">
                {
                    "userInput": {{
                    user_input
                    |
                    json
                    |
                    raw
                }},
                "searchTerm": {
                {
                search_term|json|raw }},
                "safeData": {
                "user": {{ user_name|json|raw}},
                "timestamp": {{"now"|date: "c"|json|raw}}
                }
                }
            </script>
            <div style="background: #f0f0f0; padding: 15px; border-radius: 4px; margin: 10px 0;">
                <em>JSON data safely embedded (check browser console)</em>
            </div>
        </div>
    </div>

    <!-- Filter Overview -->
    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 12px; margin: 20px 0; border: 2px solid #6c757d;">
        <h2>ğŸ“‹ Available Security Filters</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4 style="color: #28a745;">ğŸ”’ Auto-Escape</h4>
                <p><code>{{ "{{ variable }}" }}</code></p>
                <p>Default behavior - automatically escapes all output</p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4 style="color: #dc3545;">âš ï¸ Raw Output</h4>
                <p><code>{{ "{{ content|raw }}" }}</code></p>
                <p>Disables escaping - use only for trusted content</p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4 style="color: #007bff;">ğŸ¯ Context Escape</h4>
                <p><code>{{ "{{ value|escape:'html' }}" }}</code></p>
                <p>Explicit escaping: html, attr, js, css, url</p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4 style="color: #ff9800;">ğŸ“Š JSON Safe</h4>
                <p><code>{{ "{{ data|json|raw }}" }}</code></p>
                <p>Safe JSON encoding for JavaScript</p>
            </div>
        </div>
    </div>

    <!-- Security Best Practices -->
    <div style="background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); padding: 25px; border-radius: 12px; margin: 20px 0; border: 2px solid #17a2b8;">
        <h2>ğŸ” Security Best Practices</h2>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            <div>
                <h4 style="color: #28a745;">âœ… DO's</h4>
                <ul style="line-height: 1.8;">
                    <li>Always rely on auto-escape by default</li>
                    <li>Use <code>|escape:'attr'</code> for HTML attributes</li>
                    <li>Use <code>|json|raw</code> for JavaScript data</li>
                    <li>Use data-* attributes for JS integration</li>
                    <li>Validate and sanitize on the server side</li>
                    <li>Keep auto_escape = true in production</li>
                </ul>
            </div>

            <div>
                <h4 style="color: #dc3545;">âŒ DON'Ts</h4>
                <ul style="line-height: 1.8;">
                    <li>Never use <code>|raw</code> with user input</li>
                    <li>Don't disable auto-escape globally</li>
                    <li>Avoid inline JavaScript with user data</li>
                    <li>Don't trust client-side validation only</li>
                    <li>Never concatenate user input in SQL</li>
                    <li>Don't assume escaped = validated</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Test Results Summary -->
    <div style="background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%); padding: 25px; border-radius: 12px; margin: 20px 0; border: 2px solid #28a745;">
        <h2>ğŸ“Š Security Test Results</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
            <div style="text-align: center;">
                <div style="font-size: 2em; color: #28a745;">âœ…</div>
                <h4>XSS Protection</h4>
                <p>All attack vectors blocked</p>
            </div>

            <div style="text-align: center;">
                <div style="font-size: 2em; color: #28a745;">âœ…</div>
                <h4>Context Escaping</h4>
                <p>HTML, Attr, JS, CSS, URL</p>
            </div>

            <div style="text-align: center;">
                <div style="font-size: 2em; color: #28a745;">âœ…</div>
                <h4>Auto-Escape</h4>
                <p>Enabled by default</p>
            </div>

            <div style="text-align: center;">
                <div style="font-size: 2em; color: #28a745;">âœ…</div>
                <h4>Safe Raw Output</h4>
                <p>Controlled & documented</p>
            </div>
        </div>
    </div>
</div>

<!-- Safe JavaScript Examples -->
<script>
    // Method 1: Data Attributes
    const jsData = document.querySelector('#js-data');
    const userInput = jsData.dataset.userInput;
    const searchTerm = jsData.dataset.searchTerm;
    const malicious = jsData.dataset.malicious;

    console.log('ğŸ”’ Safe JavaScript data from data-* attributes:');
    console.log('User input:', userInput);
    console.log('Search term:', searchTerm);
    console.log('Malicious input (safely escaped):', malicious);

    // Method 2: JSON Data Islands
    const pageData = JSON.parse(document.getElementById('page-data').textContent);
    console.log('ğŸ”’ Safe JavaScript data from JSON island:');
    console.log('Page data:', pageData);

    // Demonstrate that XSS is blocked
    console.log('ğŸ›¡ï¸ XSS Protection Active - All user input safely escaped');

    // Show the difference
    console.log('Raw malicious input would be:', {
    {
        malicious_input | json | raw
    }
    })
    ;
    console.log('But it\'s safely escaped in HTML context');
</script>
{% endblock %}